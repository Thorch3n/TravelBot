# Телеграм бот TravelBot

Данный бот направлен на поиск авиабилетов по заданным критериям и просмотр погоды в заданном городе на 21 день вперед.


Бот будет работать на следующих API:

https://api.travelpayouts.com/aviasales/ 

https://ai-weather-by-meteosource.p.rapidapi.com/

## Необходимые действия для установки и запуска
- Скопировать репозиторий
- Установить python 3.11
- Установить зависимости `pip install -r requirements.txt`
- Получить токен от API [RapidAPI](https://rapidapi.com/MeteosourceWeather/api/ai-weather-by-meteosource/)
- Получить токен от API [Aviasales](https://support.travelpayouts.com/hc/ru/articles/203956163-Aviasales-API-доступа-к-данным-для-участников-партнёрской-программы)
- Получить токен от вашего бота создав его в Temegram @BotFather
- Заполнить файл keys.env.template полученными токенами
- Переименовать файл keys.env.template в keys.env
- Запустить файл main.py

## Ход разработки

- [X] Выбор API для работы данного бота
- [X] Выбрать endpint'ы, по которым будут проводиться запросы (указаны ниже)
- [X] Создать базу данных, куда будут сохраняться пользователи, которые обращались к боту и где будет храниться их история запросов
- [X] Написать код благодаря которому бот будет отвечать на команду /start
- [X] Написать код благодаря которому бот будет отвечать на команду /help
- [X] Написать код благодаря которому бот будет отвечать на команду /low для вывода самых дешевых рейсов из пункта отправления в пункт назначения
- [X] Написать код благодаря которому бот будет отвечать на команду /high для вывода самых поздних дат на выбранный месяц
- [X] Написать код благодаря которому бот будет отвечать на команду /custom для вывода рейсов в диапазоне цен
- [X] Написать код благодаря которому бот будет отвечать на команду /weather для вывода погоды в выбраном городе на ближайшие 21 день
- [X] Написать код благодаря которому бот будет отвечать на команду /history для вывода истории запросов пользователя
- [X] Создать базу данных, куда будут сохраняться написанные пользователем команды


## Команды

### /high
Для данной команды будут использоваться базы даных **airports.db** и **cities.db**

**Передаваемые параметры**:

point_departure: str - пункт отправления в виде строки на русском языке

destination: str - пункт назначения в виде строки на русскоим языке

date: int - дата планируемого вылета, год и месяц через пробел

Пример полученных данных:
```
Введите название города отправления на русском языке: Москва
Введите название города прибытия на русском языке: Санкт-Петербург
Введите дату отправления, год и месяц через пробел(пример: 2024 02): 2024 02

Доступные рейсы:
Рейс 1:
 - Город отправления: Москва
 - Город прибытия: Санкт-Петербург
 - Дата отправления: 2024-02-27T19:10:00
 - Стоимость: 3950 рублей
 - Ссылка на рейс: https://www.aviasales.ru/search/MOW2702LED02031?expected_price=3950&expected_price_currency=rub&expected_price_source=share&expected_price_uuid=c5bd6d2f-509b-4e7d-a4b7-f1e7fe7ae501&expected_price_value=3950&request_source=ticket_url&search_date=20022024&t=UT17090610001709065800000080VKOLED17094150001709420700000095LEDVKO_e992b554a6e6a94ff9e1faf9ad75a993_3950

Рейс 2:
 - Город отправления: Москва
 - Город прибытия: Санкт-Петербург
 - Дата отправления: 2024-02-27T19:10:00
 - Стоимость: 4251 рублей
 - Ссылка на рейс: https://www.aviasales.ru/search/MOW2702LED01031?t=DP17090610001709065800000080VKOLED17093277001709333100000090LEDSVO_61075532d9c17e156467591c18ce7023_4251&search_date=20022024&expected_price_uuid=2b157693-9c78-435c-ae46-7b7e7cae9804&expected_price_source=share&expected_price_currency=rub&expected_price=4251

Рейс 3:
 - Город отправления: Москва
 - Город прибытия: Санкт-Петербург
 - Дата отправления: 2024-02-26T18:00:00
 - Стоимость: 4448 рублей
 - Ссылка на рейс: https://www.aviasales.ru/search/MOW2602LED01031?t=DP17089704001708975800000090SVOLED17093277001709333100000090LEDSVO_57a23af1dda6dbd9dc5b773eaa665fd6_4448&search_date=20022024&expected_price_uuid=6cbb717b-6338-4976-a7cf-f7b2f27b2901&expected_price_source=share&expected_price_currency=rub&expected_price=4448
```

### /low
Для данной команды будут использоваться базы даных **airports.db** и **cities.db**

**Передаваемые параметры**:

point_departure: str - пункт отправления в виде строки на русском языке

destination: str - пункт назначения в виде строки на русскоим языке

date: int - дата планируемого вылета, год и месяц через пробел


Пример полученных данных:
```
Введите название города отправления на русском языке: Москва
Введите название города прибытия на русском языке: Санкт-Петербург
Введите дату отправления, год и месяц через пробел(пример: 2024 02): 2024 02

Доступные рейсы:
Рейс 1:
 - Город отправления: Москва
 - Город прибытия: Санкт-Петербург
 - Дата отправления: 2024-02-27T19:10:00
 - Стоимость: 3950 рублей
 - Ссылка на рейс: https://www.aviasales.ru/search/MOW2702LED02031?expected_price=3950&expected_price_currency=rub&expected_price_source=share&expected_price_uuid=c5bd6d2f-509b-4e7d-a4b7-f1e7fe7ae501&expected_price_value=3950&request_source=ticket_url&search_date=20022024&t=UT17090610001709065800000080VKOLED17094150001709420700000095LEDVKO_e992b554a6e6a94ff9e1faf9ad75a993_3950

Рейс 2:
 - Город отправления: Москва
 - Город прибытия: Санкт-Петербург
 - Дата отправления: 2024-02-27T19:10:00
 - Стоимость: 4251 рублей
 - Ссылка на рейс: https://www.aviasales.ru/search/MOW2702LED01031?t=DP17090610001709065800000080VKOLED17093277001709333100000090LEDSVO_61075532d9c17e156467591c18ce7023_4251&search_date=20022024&expected_price_uuid=2b157693-9c78-435c-ae46-7b7e7cae9804&expected_price_source=share&expected_price_currency=rub&expected_price=4251

Рейс 3:
 - Город отправления: Москва
 - Город прибытия: Санкт-Петербург
 - Дата отправления: 2024-02-26T18:00:00
 - Стоимость: 4448 рублей
 - Ссылка на рейс: https://www.aviasales.ru/search/MOW2602LED01031?t=DP17089704001708975800000090SVOLED17093277001709333100000090LEDSVO_57a23af1dda6dbd9dc5b773eaa665fd6_4448&search_date=20022024&expected_price_uuid=6cbb717b-6338-4976-a7cf-f7b2f27b2901&expected_price_source=share&expected_price_currency=rub&expected_price=4448
```

### /custom
Для данной команды будут использоваться базы даных **airports.db** и **cities.db**

**Передаваемые параметры**:

point_departure: str - пункт отправления в виде строки на русском языке

destination: str - пункт назначения в виде строки на русскоим языке

date: int - дата планируемого вылета, год и месяц через пробел

minimal_price: int - нижняя граница цен на билеты

maximal_price: int - максимальная граница цен на билеты


Пример полученных данных:
```
Введите название города отправления на русском языке: Москва
Введите название города прибытия на русском языке: Санкт-Петербург
Введите дату отправления, год и месяц через пробел(пример: 2024 02): 2024 02
Введите нижнюю границу цен в рублях: 3000
Введите верхнюю границу цен в рублях: 4500

Доступные рейсы:
Рейс 1:
 - Город отправления: Москва
 - Город прибытия: Санкт-Петербург
 - Дата отправления: 2024-02-27T19:10:00
 - Стоимость: 3950 рублей
 - Ссылка на рейс: https://www.aviasales.ru/search/MOW2702LED02031?expected_price=3950&expected_price_currency=rub&expected_price_source=share&expected_price_uuid=c5bd6d2f-509b-4e7d-a4b7-f1e7fe7ae501&expected_price_value=3950&request_source=ticket_url&search_date=20022024&t=UT17090610001709065800000080VKOLED17094150001709420700000095LEDVKO_e992b554a6e6a94ff9e1faf9ad75a993_3950

Рейс 2:
 - Город отправления: Москва
 - Город прибытия: Санкт-Петербург
 - Дата отправления: 2024-02-27T19:10:00
 - Стоимость: 4251 рублей
 - Ссылка на рейс: https://www.aviasales.ru/search/MOW2702LED01031?t=DP17090610001709065800000080VKOLED17093277001709333100000090LEDSVO_61075532d9c17e156467591c18ce7023_4251&search_date=20022024&expected_price_uuid=2b157693-9c78-435c-ae46-7b7e7cae9804&expected_price_source=share&expected_price_currency=rub&expected_price=4251

Рейс 3:
 - Город отправления: Москва
 - Город прибытия: Санкт-Петербург
 - Дата отправления: 2024-02-26T18:00:00
 - Стоимость: 4448 рублей
 - Ссылка на рейс: https://www.aviasales.ru/search/MOW2602LED01031?t=DP17089704001708975800000090SVOLED17093277001709333100000090LEDSVO_57a23af1dda6dbd9dc5b773eaa665fd6_4448&search_date=20022024&expected_price_uuid=6cbb717b-6338-4976-a7cf-f7b2f27b2901&expected_price_source=share&expected_price_currency=rub&expected_price=4448
```

### /weather
Для данной команды будет использоваться база даных **cities.db**

**Передаваемые параметры**:
 - city - город, в котором необходимо посмотреть погодные условия

Пример полученных данных:
```
Введите на русском языке названия города, в котором вы хотите посмотреть погоду: Санкт-Петербург

Город: Санкт-Петербург
Дата: 2024-02-20
Средняя температура: 10.2

Город: Санкт-Петербург
Дата: 2024-02-21
Средняя температура: 9.8

Город: Санкт-Петербург
Дата: 2024-02-22
Средняя температура: 9.2 
```
## Endpoint'ы

### Endpoint "v3/prices_for_dates"

**URL:** https://api.travelpayouts.com/aviasales/v3/prices_for_dates

**Заголовки(headers):**
 - **token:** Указывается уникальный токен для доступа к данным, токен хранится в env файле

**Метод запроса:** request.get(URL, headers)

**Ожидаемый ответ:**
 - Список рейсов в виде списка словарей.
 - Каждый рейс может содержать информацию, такую как цена на билет, пункт отправления, пункт назначения, дата вылета, аэропорт отправления, аэропорт прибытия, ссылка на рейс.

### Endpoint "find_places"

**URL:** https://ai-weather-by-meteosource.p.rapidapi.com/find_places
**Заголовки(headers):**
 - **"X-RapidAPI-Key":** Указывается ключ для RapidAPI, ключ хранится в env файле
 - **"X-RapidAPI-Host":** ai-weather-by-meteosource.p.rapidapi.com
**Метод запроса:** request.get(URL, headers)

**Ожидаемый ответ:**
 - Список городов в виде списка словарей.
 - Список городов выводится с их координатами, которые нам и необходимы.

### Endpoint "daily"

**URL:** https://ai-weather-by-meteosource.p.rapidapi.com/daily
**Заголовки(headers):**
 - **"X-RapidAPI-Key":** Указывается ключ для RapidAPI, ключ хранится в env файле
 - **"X-RapidAPI-Host":** ai-weather-by-meteosource.p.rapidapi.com

**Метод запроса:** request.get(URL, headers)

**Ожидаемый ответ:**
 - Данные по выбранному городу в виде словаря.
 - Словарь выводит такие данные как: Координаты, часовой пояс, температура по местным измерениям, скорость и направление ветра и т.д.

